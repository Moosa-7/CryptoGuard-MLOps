name: FinTech MLOps Pipeline

# Trigger on push to main branch
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    # 1. Check out the code
    - name: Checkout Code
      uses: actions/checkout@v3

    # 2. Set up Python
    - name: Set up Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: 3.9

    # 3. Install Dependencies
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 4. Run ML Data & Integrity Tests
    # (Uses the new synthetic data logic so it won't crash without CSV)
    - name: Run ML Data & Integrity Tests
      run: |
        python src/ml_tests.py

    # 5. Build Docker Images
    # (Validates that Dockerfiles and requirements are correct)
    - name: Build API Docker Image
      run: |
        docker build -f Dockerfile.api -t fintech-api .

    - name: Build Dashboard Docker Image
      run: |
        docker build -f Dockerfile.ui -t fintech-ui .